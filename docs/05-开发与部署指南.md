# æ¡Œå°æ‰«ç ç‚¹å•ç³»ç»Ÿ - å¼€å‘ä¸éƒ¨ç½²æŒ‡å—

## ä¸€ã€å¼€å‘ç¯å¢ƒæ­å»º

### 1.1 ç³»ç»Ÿè¦æ±‚

| è½¯ä»¶       | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜               |
| :--------- | :------- | :----------------- |
| Bun        | 1.x      | åŒ…ç®¡ç†å™¨å’Œè¿è¡Œæ—¶   |
| PostgreSQL | 16+      | ä¸»æ•°æ®åº“           |
| Redis      | 7.0+     | ç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ—     |
| Docker     | 20.x+    | å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰ |
| Git        | 2.x      | ç‰ˆæœ¬æ§åˆ¶           |

### 1.2 æŠ€æœ¯æ ˆ

| å±‚çº§     | æŠ€æœ¯æ ˆ                                        | è¯´æ˜                          |
| :------- | :-------------------------------------------- | :---------------------------- |
| åå°ç®¡ç† | Next.js 16, TailwindCSS, React Query, Zustand | App Router, Server Components |
| API æœåŠ¡ | Elysia, Drizzle ORM                           | é«˜æ€§èƒ½ APIï¼Œç±»å‹å®‰å…¨ ORM      |
| æ¶ˆæ¯é˜Ÿåˆ— | Redis Stream                                  | æ‰“å°ä»»åŠ¡é˜Ÿåˆ—                  |
| å®æ—¶é€šä¿¡ | WebSocket                                     | è®¢å•å®æ—¶é€šçŸ¥                  |
| æ•°æ®åº“   | PostgreSQL 16                                 | ä¸»æ•°æ®åº“                      |
| ç¼“å­˜     | Redis 7                                       | ä¼šè¯ç®¡ç†ã€å…±äº«è´­ç‰©è½¦          |

### 1.3 å®‰è£… Bun

```bash
# Windows (PowerShell)
powershell -c "irm bun.sh/install.ps1 | iex"

# macOS / Linux
curl -fsSL https://bun.sh/install | bash
```

### 1.4 å®‰è£… PostgreSQL

ä¸‹è½½åœ°å€: https://www.postgresql.org/download/

åˆ›å»ºæ•°æ®åº“:

```sql
CREATE DATABASE qr_order;
```

### 1.5 å®‰è£… Redis

- Windows: https://github.com/tporadowski/redis/releases
- macOS: `brew install redis`
- Linux: `apt install redis-server`

## äºŒã€é¡¹ç›®å¯åŠ¨

### 2.1 å…‹éš†é¡¹ç›®

```bash
cd your-workspace
# é¡¹ç›®å·²åœ¨æœ¬åœ°åˆ›å»º
```

### 2.2 API æœåŠ¡å¯åŠ¨

```bash
cd api

# 1. å®‰è£…ä¾èµ–
bun install

# 2. å¤åˆ¶ç¯å¢ƒå˜é‡
cp .env.example .env

# 3. ç¼–è¾‘ .env æ–‡ä»¶
# DATABASE_URL="postgres://postgres:password@localhost:5432/qr_order"
# REDIS_URL="redis://localhost:6379"
# JWT_SECRET="your-secret-key"

# 4. åŒæ­¥æ•°æ®åº“ç»“æ„
bun run db:push

# 5. æ’­ç§æµ‹è¯•æ•°æ®
bun run db:seed

# 6. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
bun run dev

# 7. (å¯é€‰) å¯åŠ¨æ‰“å° Worker
bun run worker:dev
```

API æœåŠ¡è¿è¡Œåœ¨: http://localhost:4000
WebSocket: ws://localhost:4000/ws/store/:storeId

### 2.3 åå°ç®¡ç†ç³»ç»Ÿå¯åŠ¨

```bash
cd admin

# 1. å®‰è£…ä¾èµ–
bun install

# 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
bun run dev
```

åå°ç®¡ç†ç³»ç»Ÿè¿è¡Œåœ¨: http://localhost:3000

### 2.4 éªŒè¯å®‰è£…

1. è®¿é—® http://localhost:4000/swagger æŸ¥çœ‹ API æ–‡æ¡£
2. è®¿é—® http://localhost:3000/login è¿›å…¥ç™»å½•é¡µ
3. ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•: admin / admin123

## ä¸‰ã€å¼€å‘æµç¨‹

### 3.1 ç›®å½•çº¦å®š

```
api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ db/schema.ts      # Drizzle æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ routes/           # API è·¯ç”±
â”‚   â”œâ”€â”€ types/            # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ ws/               # WebSocket æ¨¡å—
â”‚   â”œâ”€â”€ worker/           # Worker æœåŠ¡
â”‚   â””â”€â”€ services/         # ä¸šåŠ¡æœåŠ¡

admin/
â”œâ”€â”€ app/dashboard/        # é¡µé¢
â”œâ”€â”€ components/           # ç»„ä»¶
â”œâ”€â”€ lib/api.ts            # API å®¢æˆ·ç«¯
â”œâ”€â”€ types/                # ç±»å‹å®šä¹‰
â””â”€â”€ store/                # Zustand çŠ¶æ€
```

### 3.2 æ·»åŠ æ–°åŠŸèƒ½æµç¨‹

**åç«¯:**

1. ä¿®æ”¹ `src/db/schema.ts` æ·»åŠ æ•°æ®æ¨¡å‹
2. è¿è¡Œ `bun run db:push` åŒæ­¥æ•°æ®åº“
3. åœ¨ `src/routes/` åˆ›å»ºè·¯ç”±æ–‡ä»¶
4. åœ¨ `src/types/index.ts` æ·»åŠ ç±»å‹å®šä¹‰
5. åœ¨ `src/index.ts` æ³¨å†Œè·¯ç”±

**å‰ç«¯:**

1. åœ¨ `types/index.ts` æ·»åŠ å¯¹åº”ç±»å‹
2. åœ¨ `lib/api.ts` æ·»åŠ  API æ–¹æ³•
3. åœ¨ `app/dashboard/` åˆ›å»ºé¡µé¢
4. åœ¨ `components/layout/sidebar.tsx` æ·»åŠ èœå•

### 3.3 å¸¸ç”¨å‘½ä»¤

**API é¡¹ç›®:**

```bash
bun run dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
bun run start        # ç”Ÿäº§æ¨¡å¼å¯åŠ¨
bun run worker       # å¯åŠ¨æ‰“å° Worker
bun run db:push      # åŒæ­¥æ•°æ®åº“ç»“æ„
bun run db:generate  # ç”Ÿæˆè¿ç§»æ–‡ä»¶
bun run db:studio    # æ‰“å¼€ Drizzle Studio
bun run db:seed      # æ’­ç§æµ‹è¯•æ•°æ®
```

**Admin é¡¹ç›®:**

```bash
npm run dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run build        # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run start        # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm run lint         # ESLint æ£€æŸ¥
npm run lint:fix     # ESLint è‡ªåŠ¨ä¿®å¤
npm run typecheck    # TypeScript ç±»å‹æ£€æŸ¥
npm run format       # Prettier æ ¼å¼åŒ–
```

## å››ã€ä»£ç è´¨é‡å·¥å…·

é¡¹ç›®é…ç½®äº†å®Œæ•´çš„ä»£ç è´¨é‡å·¥å…·é“¾ï¼Œç¡®ä¿ä»£ç è§„èŒƒä¸€è‡´ã€‚

### 4.1 å·¥å…·æ¦‚è§ˆ

| å·¥å…·         | ä½œç”¨             | é…ç½®æ–‡ä»¶            |
| :----------- | :--------------- | :------------------ |
| ESLint       | ä»£ç è§„èŒƒæ£€æŸ¥     | `eslint.config.mjs` |
| Prettier     | ä»£ç æ ¼å¼åŒ–       | `.prettierrc`       |
| Husky        | Git hooks ç®¡ç†   | `.husky/`           |
| lint-staged  | åªæ£€æŸ¥æš‚å­˜æ–‡ä»¶   | `package.json`      |
| EditorConfig | è·¨ç¼–è¾‘å™¨æ ¼å¼ç»Ÿä¸€ | `.editorconfig`     |

### 4.2 æäº¤å‰è‡ªåŠ¨æ£€æŸ¥

æ¯æ¬¡ `git commit` æ—¶ä¼šè‡ªåŠ¨è¿è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š

```
git commit -m "feat: xxx"
  â”‚
  â”œâ”€â”€ ğŸ“¦ Admin é¡¹ç›®
  â”‚   â”œâ”€â”€ lint-staged (ESLint + Prettier)
  â”‚   â””â”€â”€ tsc --noEmit (TypeScript æ£€æŸ¥)
  â”‚
  â”œâ”€â”€ ğŸ“¦ API é¡¹ç›®
  â”‚   â”œâ”€â”€ lint-staged (ESLint + Prettier)
  â”‚   â””â”€â”€ tsc --noEmit (TypeScript æ£€æŸ¥)
  â”‚
  â””â”€â”€ âœ… é€šè¿‡åˆ™æäº¤æˆåŠŸ
```

å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œæäº¤ä¼šè¢«é˜»æ­¢ï¼Œéœ€è¦å…ˆä¿®å¤é”™è¯¯ã€‚

### 4.3 ç¼–è¾‘å™¨é…ç½® (VSCode)

é¡¹ç›®åŒ…å« `.vscode/settings.json`ï¼Œå®‰è£…æ¨èæ‰©å±•åæ”¯æŒï¼š

- **ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–**: Prettier æ ¼å¼åŒ–ä»£ç 
- **ä¿å­˜æ—¶è‡ªåŠ¨ä¿®å¤**: ESLint è‡ªåŠ¨ä¿®å¤å¯ä¿®å¤çš„é—®é¢˜
- **TypeScript æ™ºèƒ½æç¤º**: ä½¿ç”¨é¡¹ç›®å†…çš„ TypeScript ç‰ˆæœ¬

**æ¨èæ‰©å±•** (`.vscode/extensions.json`):

- Prettier - Code formatter
- ESLint
- Tailwind CSS IntelliSense
- GitLens

### 4.4 æ‰‹åŠ¨è¿è¡Œæ£€æŸ¥

```bash
# Admin é¡¹ç›®
cd admin
npm run lint           # æ£€æŸ¥ ESLint
npm run lint:fix       # è‡ªåŠ¨ä¿®å¤
npm run typecheck      # TypeScript æ£€æŸ¥
npm run format         # Prettier æ ¼å¼åŒ–

# API é¡¹ç›®
cd api
bun run lint           # æ£€æŸ¥ ESLint
bun run lint:fix       # è‡ªåŠ¨ä¿®å¤
bun run typecheck      # TypeScript æ£€æŸ¥
bun run format         # Prettier æ ¼å¼åŒ–
```

### 4.5 è·³è¿‡æ£€æŸ¥ï¼ˆä¸æ¨èï¼‰

å¦‚æœéœ€è¦ä¸´æ—¶è·³è¿‡ pre-commit æ£€æŸ¥ï¼š

```bash
git commit -m "fix: xxx" --no-verify
```

âš ï¸ è¯·ä»…åœ¨ç´§æ€¥æƒ…å†µä¸‹ä½¿ç”¨ï¼Œæ­£å¸¸å¼€å‘åº”ç¡®ä¿ä»£ç é€šè¿‡æ‰€æœ‰æ£€æŸ¥ã€‚

## äº”ã€ç”Ÿäº§éƒ¨ç½²

### 5.1 Docker Compose ä¸€é”®éƒ¨ç½²

```bash
# 1. å¤åˆ¶ç¯å¢ƒå˜é‡
cp .env.example .env

# 2. ç¼–è¾‘ .env è®¾ç½®å¯†ç 
# POSTGRES_PASSWORD=your_password
# JWT_SECRET=your_jwt_secret

# 3. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 4. åˆå§‹åŒ–æ•°æ®åº“
docker-compose exec api bun run db:push
docker-compose exec api bun run db:seed

# 5. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### 5.2 æœåŠ¡è¯´æ˜

| æœåŠ¡     | ç«¯å£ | è¯´æ˜              |
| :------- | :--- | :---------------- |
| postgres | 5432 | PostgreSQL æ•°æ®åº“ |
| redis    | 6379 | Redis ç¼“å­˜        |
| api      | 4000 | API æœåŠ¡          |
| worker   | -    | æ‰“å°ä»»åŠ¡ Worker   |
| admin    | 3000 | åå°ç®¡ç†ç³»ç»Ÿ      |

### 5.3 å¸¸ç”¨å‘½ä»¤

```bash
# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart

# é‡æ–°æ„å»º
docker-compose build --no-cache

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# è¿›å…¥å®¹å™¨
docker-compose exec api sh
```

### 5.4 æ•°æ®æŒä¹…åŒ–

æ•°æ®å­˜å‚¨åœ¨ Docker volumes ä¸­:

- `postgres_data`: æ•°æ®åº“æ–‡ä»¶
- `redis_data`: Redis æ•°æ®

### 5.5 Nginx åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

å¯ç”¨ç”Ÿäº§ç¯å¢ƒ Nginx:

```bash
docker-compose --profile production up -d nginx
```

Nginx é…ç½®ä½äº `nginx/nginx.conf`

## å…­ã€ç¯å¢ƒå˜é‡è¯´æ˜

### 6.1 Docker Compose ç¯å¢ƒå˜é‡

| å˜é‡å            | å¿…å¡« | è¯´æ˜         | é»˜è®¤å€¼      |
| :---------------- | :--- | :----------- | :---------- |
| POSTGRES_USER     | å¦   | æ•°æ®åº“ç”¨æˆ·   | postgres    |
| POSTGRES_PASSWORD | æ˜¯   | æ•°æ®åº“å¯†ç    | postgres123 |
| POSTGRES_DB       | å¦   | æ•°æ®åº“å     | qr_order    |
| JWT_SECRET        | æ˜¯   | JWT ç­¾åå¯†é’¥ | -           |

### 6.2 API ç¯å¢ƒå˜é‡

| å˜é‡å       | å¿…å¡« | è¯´æ˜                  | ç¤ºä¾‹                                        |
| :----------- | :--- | :-------------------- | :------------------------------------------ |
| DATABASE_URL | æ˜¯   | PostgreSQL è¿æ¥å­—ç¬¦ä¸² | postgres://user:pwd@localhost:5432/qr_order |
| REDIS_URL    | å¦   | Redis è¿æ¥å­—ç¬¦ä¸²      | redis://localhost:6379                      |
| JWT_SECRET   | æ˜¯   | JWT ç­¾åå¯†é’¥          | your-super-secret-key                       |
| PORT         | å¦   | æœåŠ¡ç«¯å£              | 4000                                        |
| NODE_ENV     | å¦   | ç¯å¢ƒæ¨¡å¼              | development / production                    |

### 6.3 Admin ç¯å¢ƒå˜é‡

| å˜é‡å              | å¿…å¡« | è¯´æ˜           | ç¤ºä¾‹                  |
| :------------------ | :--- | :------------- | :-------------------- |
| NEXT_PUBLIC_API_URL | å¦   | API åœ°å€       | http://localhost:4000 |
| NEXT_PUBLIC_WS_URL  | å¦   | WebSocket åœ°å€ | ws://localhost:4000   |

## ä¸ƒã€ç›‘æ§ä¸è¿ç»´

### 7.1 å¥åº·æ£€æŸ¥

```bash
# API å¥åº·æ£€æŸ¥
curl http://localhost:4000/health

# å“åº”
{
  "status": "ok",
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

### 7.2 æ—¥å¿—æŸ¥çœ‹

```bash
# Docker æ—¥å¿—
docker-compose logs -f api
docker-compose logs -f admin

# å¼€å‘ç¯å¢ƒ
# æ§åˆ¶å°ç›´æ¥è¾“å‡º
```

### 7.3 æ•°æ®åº“å¤‡ä»½

```bash
# å¯¼å‡ºæ•°æ®åº“ (Docker)
docker-compose exec postgres pg_dump -U postgres qr_order > backup.sql

# å¯¼å…¥æ•°æ®åº“
docker-compose exec -T postgres psql -U postgres qr_order < backup.sql
```

## å…«ã€å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“è¿æ¥å¤±è´¥

æ£€æŸ¥:

- PostgreSQL æœåŠ¡æ˜¯å¦å¯åŠ¨
- DATABASE_URL æ ¼å¼æ˜¯å¦æ­£ç¡®
- æ•°æ®åº“ç”¨æˆ·æƒé™

### Q2: Redis è¿æ¥å¤±è´¥

æ£€æŸ¥:

- Redis æœåŠ¡æ˜¯å¦å¯åŠ¨ (å¯é€‰ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½)
- REDIS_URL æ ¼å¼æ˜¯å¦æ­£ç¡®
- é˜²ç«å¢™ç«¯å£

### Q3: ç™»å½•åè·³è½¬å¼‚å¸¸

æ£€æŸ¥:

- JWT_SECRET æ˜¯å¦é…ç½®
- Token æ˜¯å¦æ­£ç¡®å­˜å‚¨
- æµè§ˆå™¨ localStorage

### Q4: API è·¨åŸŸé—®é¢˜

æ£€æŸ¥ API çš„ CORS é…ç½®:

```typescript
cors({
  origin: ["http://localhost:3000"],
  credentials: true,
});
```

## å…«ã€è”ç³»æ”¯æŒ

å¦‚é‡é—®é¢˜ï¼Œè¯·æ£€æŸ¥:

1. ç¯å¢ƒå˜é‡é…ç½®
2. ä¾èµ–å®‰è£…å®Œæ•´æ€§
3. æ•°æ®åº“/Redis æœåŠ¡çŠ¶æ€
4. æ§åˆ¶å°é”™è¯¯æ—¥å¿—
