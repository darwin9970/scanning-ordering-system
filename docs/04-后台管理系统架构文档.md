# 桌台扫码点单系统 - 后台管理系统架构文档

## 一、技术架构

### 1.1 技术选型

| 技术 | 版本 | 用途 |
|:---|:---|:---|
| Next.js | 16.x | React 全栈框架，支持 App Router |
| React | 19.x | UI 库 |
| TailwindCSS | 4.x | 原子化 CSS 框架 |
| TypeScript | 5.x | 类型安全 |
| Zustand | 5.x | 轻量级状态管理 |
| React Query | 5.x | 服务端状态管理 |
| Radix UI | - | 无障碍 UI 原语组件 |
| Lucide React | - | 图标库 |

### 1.2 架构特点

- **Server Components 优先**: 默认使用服务端组件，减少客户端 JS 体积
- **App Router**: 使用 Next.js 13+ 的新路由系统
- **组件化设计**: 基于 shadcn/ui 风格的组件库
- **响应式布局**: 支持桌面端和移动端适配

## 二、目录结构

```
admin/
├── app/                       # App Router 页面
│   ├── layout.tsx             # 根布局
│   ├── page.tsx               # 首页（重定向）
│   ├── login/                 # 登录页
│   │   └── page.tsx
│   └── dashboard/             # 后台页面
│       ├── layout.tsx         # 后台布局
│       ├── page.tsx           # 概览页
│       ├── orders/            # 订单管理
│       ├── products/          # 商品管理
│       ├── categories/        # 分类管理
│       ├── tables/            # 桌台管理
│       ├── printers/          # 打印机配置
│       ├── stores/            # 门店管理
│       ├── reports/           # 数据报表
│       ├── staff/             # 员工管理
│       └── settings/          # 系统设置
├── components/
│   ├── ui/                    # 基础 UI 组件
│   │   ├── button.tsx
│   │   ├── input.tsx
│   │   ├── card.tsx
│   │   ├── badge.tsx
│   │   ├── dialog.tsx
│   │   ├── table.tsx
│   │   ├── label.tsx
│   │   ├── select.tsx
│   │   ├── textarea.tsx
│   │   └── switch.tsx
│   ├── layout/                # 布局组件
│   │   ├── sidebar.tsx        # 侧边栏
│   │   ├── header.tsx         # 顶部导航
│   │   └── dashboard-layout.tsx
│   └── providers.tsx          # Provider 组件
├── lib/
│   ├── api.ts                 # API 客户端
│   ├── utils.ts               # 工具函数
│   ├── validations.ts         # 表单校验
│   └── websocket.ts           # WebSocket Hook
├── store/
│   └── auth.ts                # 认证状态
└── types/
    └── index.ts               # TypeScript 类型定义
```

## 三、核心模块说明

### 3.1 认证模块

**认证流程:**

```
用户访问 → 检查 Token → 无效则跳转登录 → 登录成功存储 Token → 进入后台
```

**状态管理 (Zustand):**

```typescript
interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  setAuth: (user: User, token: string) => void;
  logout: () => void;
}
```

### 3.2 布局系统

**DashboardLayout 组件:**

- 左侧固定侧边栏 (256px)
- 顶部固定导航栏 (64px)
- 主内容区域自适应

**导航菜单:**

| 菜单 | 路径 | 图标 |
|:---|:---|:---|
| 概览 | /dashboard | LayoutDashboard |
| 订单管理 | /dashboard/orders | ShoppingCart |
| 菜品管理 | /dashboard/products | ChefHat |
| 分类管理 | /dashboard/categories | UtensilsCrossed |
| 桌台管理 | /dashboard/tables | QrCode |
| 打印机配置 | /dashboard/printers | Printer |
| 门店管理 | /dashboard/stores | Store |
| 数据报表 | /dashboard/reports | BarChart3 |
| 员工管理 | /dashboard/staff | Users |
| 系统设置 | /dashboard/settings | Settings |

### 3.3 API 客户端

**封装特性:**

- 统一请求/响应处理
- 自动携带 Token
- 类型安全的方法定义

```typescript
class ApiClient {
  // 通用请求方法
  async request<T>(endpoint: string, options?: RequestOptions): Promise<T>
  
  // 业务方法
  login(username: string, password: string): Promise<AuthResponse>
  getOrders(params?: OrderQuery): Promise<PaginatedResponse<Order>>
  // ...
}
```

### 3.4 UI 组件库

基于 shadcn/ui 风格，使用 Radix UI 原语 + TailwindCSS 构建:

| 组件 | 说明 |
|:---|:---|
| Button | 按钮，支持多种变体 |
| Input | 输入框 |
| Card | 卡片容器 |
| Badge | 标签/徽章 |
| Dialog | 弹窗 |
| Table | 数据表格 |
| Select | 下拉选择器 |
| Label | 表单标签 |

## 四、页面功能说明

### 4.1 数据概览 (Dashboard)

- **统计卡片**: 今日订单、营收、待处理订单、在售商品
- **最近订单**: 展示最近 5 条订单
- **热销商品**: 销量 Top 5 商品

### 4.2 订单管理

- **订单列表**: 分页、状态筛选、订单号搜索
- **订单详情**: 弹窗查看订单明细
- **状态操作**: 确认、完成、退款

### 4.3 商品管理

- **商品列表**: 分类筛选、关键词搜索
- **添加/编辑商品**: 弹窗表单
- **状态切换**: 上架/下架/售罄

### 4.4 分类管理

- **分类列表**: 拖拽排序 (预留)
- **添加/编辑分类**: 弹窗表单
- **打印机绑定**: 查看关联的打印机

### 4.5 桌台管理

- **卡片视图**: 直观展示桌台状态
- **批量创建**: 快速创建多个桌台
- **二维码管理**: 重新生成二维码

### 4.6 打印机配置

- **打印机列表**: 展示 SN 码、类型、绑定分类
- **测试打印**: 发送测试页
- **分类绑定**: 多选分类实现分单

### 4.7 数据报表

- **时间筛选**: 7天/14天/30天
- **销售趋势**: 柱状图展示
- **分类统计**: 各分类销量
- **热销排行**: Top 10 商品

## 五、状态管理设计

### 5.1 全局状态 (Zustand)

```typescript
// 认证状态
const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      token: null,
      isAuthenticated: false,
      setAuth: (user, token) => set({ user, token, isAuthenticated: true }),
      logout: () => set({ user: null, token: null, isAuthenticated: false }),
    }),
    { name: 'auth-storage' }
  )
);
```

### 5.2 服务端状态 (React Query)

```typescript
// 订单列表
const { data, isLoading, refetch } = useQuery({
  queryKey: ['orders', page, status],
  queryFn: () => api.getOrders({ page, status }),
});

// 创建商品
const createMutation = useMutation({
  mutationFn: (data) => api.createProduct(data),
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ['products'] });
  },
});
```

## 六、样式系统

### 6.1 CSS 变量

```css
:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --primary: 221.2 83.2% 53.3%;
  --primary-foreground: 210 40% 98%;
  --destructive: 0 84.2% 60.2%;
  --border: 214.3 31.8% 91.4%;
  --radius: 0.5rem;
}
```

### 6.2 组件变体 (CVA)

```typescript
const buttonVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground",
        destructive: "bg-destructive text-destructive-foreground",
        outline: "border border-input bg-background",
        ghost: "hover:bg-accent",
      },
      size: {
        default: "h-9 px-4 py-2",
        sm: "h-8 px-3",
        lg: "h-10 px-8",
        icon: "h-9 w-9",
      },
    },
  }
);
```

## 七、权限控制 (预留)

### 7.1 RBAC 模型

| 角色 | 权限 |
|:---|:---|
| SUPER_ADMIN | 全部权限，可管理所有门店 |
| OWNER | 管理本门店数据 |
| STAFF | 查看订单、处理订单 |

### 7.2 路由守卫

```typescript
// middleware.ts (待实现)
export function middleware(request: NextRequest) {
  const token = request.cookies.get('token');
  if (!token && request.nextUrl.pathname.startsWith('/dashboard')) {
    return NextResponse.redirect(new URL('/login', request.url));
  }
}
```

## 八、性能优化

- **Server Components**: 默认服务端渲染，减少客户端 JS
- **动态导入**: 大型组件按需加载
- **图片优化**: 使用 Next.js Image 组件
- **缓存策略**: React Query 智能缓存

## 九、后续计划

- [ ] 完善权限控制中间件
- [ ] 添加操作日志记录
- [ ] 实现实时订单通知 (WebSocket)
- [ ] 优化移动端体验
- [ ] 添加主题切换功能
