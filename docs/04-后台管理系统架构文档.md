# æ¡Œå°æ‰«ç ç‚¹å•ç³»ç»Ÿ - åå°ç®¡ç†ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ä¸€ã€æŠ€æœ¯æ¶æ„

### 1.1 æŠ€æœ¯é€‰å‹

| æŠ€æœ¯         | ç‰ˆæœ¬ | ç”¨é€”                            |
| :----------- | :--- | :------------------------------ |
| Next.js      | 16.x | React å…¨æ ˆæ¡†æ¶ï¼Œæ”¯æŒ App Router |
| React        | 19.x | UI åº“                           |
| TailwindCSS  | 4.x  | åŸå­åŒ– CSS æ¡†æ¶                 |
| TypeScript   | 5.x  | ç±»å‹å®‰å…¨                        |
| Zustand      | 5.x  | è½»é‡çº§çŠ¶æ€ç®¡ç†                  |
| React Query  | 5.x  | æœåŠ¡ç«¯çŠ¶æ€ç®¡ç†                  |
| Radix UI     | -    | æ— éšœç¢ UI åŸè¯­ç»„ä»¶              |
| Lucide React | -    | å›¾æ ‡åº“                          |
| @dnd-kit     | 6.x  | æ‹–æ‹½åº“                          |
| Recharts     | 3.x  | å›¾è¡¨åº“                          |
| Husky        | 9.x  | Git hooks                       |
| lint-staged  | 15.x | æš‚å­˜æ–‡ä»¶æ£€æŸ¥                    |

### 1.2 æ¶æ„ç‰¹ç‚¹

- **Server Components ä¼˜å…ˆ**: é»˜è®¤ä½¿ç”¨æœåŠ¡ç«¯ç»„ä»¶ï¼Œå‡å°‘å®¢æˆ·ç«¯ JS ä½“ç§¯
- **App Router**: ä½¿ç”¨ Next.js 13+ çš„æ–°è·¯ç”±ç³»ç»Ÿ
- **ç»„ä»¶åŒ–è®¾è®¡**: åŸºäº shadcn/ui é£æ ¼çš„ç»„ä»¶åº“
- **å“åº”å¼å¸ƒå±€**: æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯é€‚é…

## äºŒã€ç›®å½•ç»“æ„

```
admin/
â”œâ”€â”€ app/                       # App Router é¡µé¢
â”‚   â”œâ”€â”€ layout.tsx             # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx               # é¦–é¡µï¼ˆé‡å®šå‘ï¼‰
â”‚   â”œâ”€â”€ login/                 # ç™»å½•é¡µ
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ dashboard/             # åå°é¡µé¢
â”‚       â”œâ”€â”€ layout.tsx         # åå°å¸ƒå±€
â”‚       â”œâ”€â”€ page.tsx           # æ¦‚è§ˆé¡µ
â”‚       â”œâ”€â”€ orders/            # è®¢å•ç®¡ç†
â”‚       â”œâ”€â”€ products/          # å•†å“ç®¡ç†
â”‚       â”œâ”€â”€ categories/        # åˆ†ç±»ç®¡ç†
â”‚       â”œâ”€â”€ tables/            # æ¡Œå°ç®¡ç†
â”‚       â”œâ”€â”€ printers/          # æ‰“å°æœºé…ç½®
â”‚       â”œâ”€â”€ stores/            # é—¨åº—ç®¡ç†
â”‚       â”‚   â””â”€â”€ [id]/design/   # é¡µé¢è£…ä¿®ç³»ç»Ÿ ğŸ†•
â”‚       â”‚       â”œâ”€â”€ page.tsx
â”‚       â”‚       â”œâ”€â”€ constants.tsx
â”‚       â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚       â”‚   â”œâ”€â”€ useComponents.ts
â”‚       â”‚       â”‚   â””â”€â”€ usePageConfig.ts
â”‚       â”‚       â””â”€â”€ components/
â”‚       â”‚           â”œâ”€â”€ ComponentPreview.tsx
â”‚       â”‚           â”œâ”€â”€ ComponentConfig.tsx
â”‚       â”‚           â”œâ”€â”€ FreeCanvas.tsx
â”‚       â”‚           â”œâ”€â”€ CanvasItem.tsx
â”‚       â”‚           â””â”€â”€ DraggableComponentItem.tsx
â”‚       â”œâ”€â”€ members/           # ä¼šå‘˜ç®¡ç†
â”‚       â”œâ”€â”€ coupons/           # ä¼˜æƒ åˆ¸ç®¡ç†
â”‚       â”œâ”€â”€ roles/             # è§’è‰²æƒé™
â”‚       â”œâ”€â”€ reports/           # æ•°æ®æŠ¥è¡¨
â”‚       â”œâ”€â”€ staff/             # å‘˜å·¥ç®¡ç†
â”‚       â””â”€â”€ settings/          # ç³»ç»Ÿè®¾ç½®
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                    # åŸºç¡€ UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”œâ”€â”€ table.tsx
â”‚   â”‚   â”œâ”€â”€ label.tsx
â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”œâ”€â”€ textarea.tsx
â”‚   â”‚   â””â”€â”€ switch.tsx
â”‚   â”œâ”€â”€ layout/                # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ sidebar.tsx        # ä¾§è¾¹æ 
â”‚   â”‚   â”œâ”€â”€ header.tsx         # é¡¶éƒ¨å¯¼èˆª
â”‚   â”‚   â””â”€â”€ dashboard-layout.tsx
â”‚   â””â”€â”€ providers.tsx          # Provider ç»„ä»¶
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api.ts                 # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ utils.ts               # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ validations.ts         # è¡¨å•æ ¡éªŒ
â”‚   â””â”€â”€ websocket.ts           # WebSocket Hook
â”œâ”€â”€ store/
â”‚   â””â”€â”€ auth.ts                # è®¤è¯çŠ¶æ€
â””â”€â”€ types/
    â””â”€â”€ index.ts               # TypeScript ç±»å‹å®šä¹‰
```

## ä¸‰ã€æ ¸å¿ƒæ¨¡å—è¯´æ˜

### 3.1 è®¤è¯æ¨¡å—

**è®¤è¯æµç¨‹:**

```
ç”¨æˆ·è®¿é—® â†’ æ£€æŸ¥ Token â†’ æ— æ•ˆåˆ™è·³è½¬ç™»å½• â†’ ç™»å½•æˆåŠŸå­˜å‚¨ Token â†’ è¿›å…¥åå°
```

**çŠ¶æ€ç®¡ç† (Zustand):**

```typescript
interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  setAuth: (user: User, token: string) => void;
  logout: () => void;
}
```

### 3.2 å¸ƒå±€ç³»ç»Ÿ

**DashboardLayout ç»„ä»¶:**

- å·¦ä¾§å›ºå®šä¾§è¾¹æ  (256px)
- é¡¶éƒ¨å›ºå®šå¯¼èˆªæ  (64px)
- ä¸»å†…å®¹åŒºåŸŸè‡ªé€‚åº”

**å¯¼èˆªèœå•:**

| èœå•       | è·¯å¾„                  | å›¾æ ‡            |
| :--------- | :-------------------- | :-------------- |
| æ¦‚è§ˆ       | /dashboard            | LayoutDashboard |
| è®¢å•ç®¡ç†   | /dashboard/orders     | ShoppingCart    |
| èœå“ç®¡ç†   | /dashboard/products   | ChefHat         |
| åˆ†ç±»ç®¡ç†   | /dashboard/categories | UtensilsCrossed |
| æ¡Œå°ç®¡ç†   | /dashboard/tables     | QrCode          |
| æ‰“å°æœºé…ç½® | /dashboard/printers   | Printer         |
| é—¨åº—ç®¡ç†   | /dashboard/stores     | Store           |
| æ•°æ®æŠ¥è¡¨   | /dashboard/reports    | BarChart3       |
| å‘˜å·¥ç®¡ç†   | /dashboard/staff      | Users           |
| ç³»ç»Ÿè®¾ç½®   | /dashboard/settings   | Settings        |

### 3.3 API å®¢æˆ·ç«¯

**å°è£…ç‰¹æ€§:**

- ç»Ÿä¸€è¯·æ±‚/å“åº”å¤„ç†
- è‡ªåŠ¨æºå¸¦ Token
- ç±»å‹å®‰å…¨çš„æ–¹æ³•å®šä¹‰

```typescript
class ApiClient {
  // é€šç”¨è¯·æ±‚æ–¹æ³•
  async request<T>(endpoint: string, options?: RequestOptions): Promise<T>;

  // ä¸šåŠ¡æ–¹æ³•
  login(username: string, password: string): Promise<AuthResponse>;
  getOrders(params?: OrderQuery): Promise<PaginatedResponse<Order>>;
  // ...
}
```

### 3.4 UI ç»„ä»¶åº“

åŸºäº shadcn/ui é£æ ¼ï¼Œä½¿ç”¨ Radix UI åŸè¯­ + TailwindCSS æ„å»º:

| ç»„ä»¶   | è¯´æ˜               |
| :----- | :----------------- |
| Button | æŒ‰é’®ï¼Œæ”¯æŒå¤šç§å˜ä½“ |
| Input  | è¾“å…¥æ¡†             |
| Card   | å¡ç‰‡å®¹å™¨           |
| Badge  | æ ‡ç­¾/å¾½ç«           |
| Dialog | å¼¹çª—               |
| Table  | æ•°æ®è¡¨æ ¼           |
| Select | ä¸‹æ‹‰é€‰æ‹©å™¨         |
| Label  | è¡¨å•æ ‡ç­¾           |

## å››ã€é¡µé¢åŠŸèƒ½è¯´æ˜

### 4.1 æ•°æ®æ¦‚è§ˆ (Dashboard)

- **ç»Ÿè®¡å¡ç‰‡**: ä»Šæ—¥è®¢å•ã€è¥æ”¶ã€å¾…å¤„ç†è®¢å•ã€åœ¨å”®å•†å“
- **æœ€è¿‘è®¢å•**: å±•ç¤ºæœ€è¿‘ 5 æ¡è®¢å•
- **çƒ­é”€å•†å“**: é”€é‡ Top 5 å•†å“

### 4.2 è®¢å•ç®¡ç†

- **è®¢å•åˆ—è¡¨**: åˆ†é¡µã€çŠ¶æ€ç­›é€‰ã€è®¢å•å·æœç´¢
- **è®¢å•è¯¦æƒ…**: å¼¹çª—æŸ¥çœ‹è®¢å•æ˜ç»†
- **çŠ¶æ€æ“ä½œ**: ç¡®è®¤ã€å®Œæˆã€é€€æ¬¾

### 4.3 å•†å“ç®¡ç†

- **å•†å“åˆ—è¡¨**: åˆ†ç±»ç­›é€‰ã€å…³é”®è¯æœç´¢
- **æ·»åŠ /ç¼–è¾‘å•†å“**: å¼¹çª—è¡¨å•
- **çŠ¶æ€åˆ‡æ¢**: ä¸Šæ¶/ä¸‹æ¶/å”®ç½„

### 4.4 åˆ†ç±»ç®¡ç†

- **åˆ†ç±»åˆ—è¡¨**: æ‹–æ‹½æ’åº (é¢„ç•™)
- **æ·»åŠ /ç¼–è¾‘åˆ†ç±»**: å¼¹çª—è¡¨å•
- **æ‰“å°æœºç»‘å®š**: æŸ¥çœ‹å…³è”çš„æ‰“å°æœº

### 4.5 æ¡Œå°ç®¡ç†

- **å¡ç‰‡è§†å›¾**: ç›´è§‚å±•ç¤ºæ¡Œå°çŠ¶æ€
- **æ‰¹é‡åˆ›å»º**: å¿«é€Ÿåˆ›å»ºå¤šä¸ªæ¡Œå°
- **äºŒç»´ç ç®¡ç†**: é‡æ–°ç”ŸæˆäºŒç»´ç 

### 4.6 æ‰“å°æœºé…ç½®

- **æ‰“å°æœºåˆ—è¡¨**: å±•ç¤º SN ç ã€ç±»å‹ã€ç»‘å®šåˆ†ç±»
- **æµ‹è¯•æ‰“å°**: å‘é€æµ‹è¯•é¡µ
- **åˆ†ç±»ç»‘å®š**: å¤šé€‰åˆ†ç±»å®ç°åˆ†å•

### 4.7 æ•°æ®æŠ¥è¡¨

- **æ—¶é—´ç­›é€‰**: 7 å¤©/14 å¤©/30 å¤©
- **é”€å”®è¶‹åŠ¿**: æŸ±çŠ¶å›¾å±•ç¤º
- **åˆ†ç±»ç»Ÿè®¡**: å„åˆ†ç±»é”€é‡
- **çƒ­é”€æ’è¡Œ**: Top 10 å•†å“

### 4.8 é¡µé¢è£…ä¿®ç³»ç»Ÿ ğŸ†•

å•†å®¶å¯è§†åŒ–é…ç½®å°ç¨‹åºé¡µé¢çš„è‡ªç”±ç”»å¸ƒç¼–è¾‘å™¨ã€‚

#### åŠŸèƒ½ç‰¹æ€§

| ç‰¹æ€§          | è¯´æ˜                               |
| :------------ | :--------------------------------- |
| **è‡ªç”±ç”»å¸ƒ**  | ç»„ä»¶å¯æ‹–æ”¾åˆ°ä»»æ„ä½ç½®ï¼Œæ”¯æŒç»å¯¹å®šä½ |
| **æ‹–æ‹½è°ƒæ•´**  | æ”¯æŒç§»åŠ¨ä½ç½®å’Œç¼©æ”¾å¤§å°             |
| **å®æ—¶é¢„è§ˆ**  | iPhone 15 Pro æ¨¡æ‹Ÿå™¨ (375Ã—668)     |
| **æ¨¡æ¿åº“**    | é¢„è®¾æ¨¡æ¿ä¸€é”®åº”ç”¨                   |
| **æ’¤é”€/é‡åš** | å®Œæ•´çš„æ“ä½œå†å²ç®¡ç†                 |

#### ç»„ä»¶åˆ†ç±»

| åˆ†ç±»     | ç»„ä»¶                                             |
| :------- | :----------------------------------------------- |
| æç®€ç»„ä»¶ | ç„¦ç‚¹å…¥å£ã€é›†ç« å¡ã€æœç´¢æ¡†ã€é—¨åº—æ ‡é¢˜ã€è´­ç‰©è½¦æµ®çª—   |
| æ ‡å‡†ç»„ä»¶ | è½®æ’­å›¾ã€å¯¼èˆªæ ¼å­ã€å…¬å‘Šæ ã€å•†å“åˆ—è¡¨/ç½‘æ ¼ã€ä¼˜æƒ åˆ¸  |
| åŸºç¡€å…ƒç´  | å›¾ç‰‡ã€æ–‡å­—ã€é—´è·ã€æ‚¬æµ®çª—ã€è‡ªç”±å®¹å™¨               |
| ä¸“å±ç»„ä»¶ | ç‚¹å•ç»„ä»¶ã€ç”¨æˆ·ä¿¡æ¯ã€åŠŸèƒ½å…¥å£ã€é—¨åº—åˆ—è¡¨ã€å……å€¼é€‰é¡¹ |

#### æ¶æ„è®¾è®¡

```
stores/[id]/design/
â”œâ”€â”€ page.tsx              # ä¸»é¡µé¢ï¼Œç®¡ç†å…¨å±€çŠ¶æ€å’Œæ‹–æ‹½
â”œâ”€â”€ constants.tsx         # ç»„ä»¶å®šä¹‰ã€é»˜è®¤å±æ€§ã€æ¨¡æ¿
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useComponents.ts  # ç»„ä»¶çŠ¶æ€ç®¡ç† Hook
â”‚   â””â”€â”€ usePageConfig.ts  # é¡µé¢é…ç½®ç®¡ç† Hook
â””â”€â”€ components/
    â”œâ”€â”€ FreeCanvas.tsx    # è‡ªç”±ç”»å¸ƒå®¹å™¨
    â”œâ”€â”€ CanvasItem.tsx    # ç”»å¸ƒä¸­çš„å¯æ‹–æ‹½ç»„ä»¶
    â”œâ”€â”€ ComponentPreview.tsx  # ç»„ä»¶é¢„è§ˆæ¸²æŸ“
    â”œâ”€â”€ ComponentConfig.tsx   # ç»„ä»¶å±æ€§é…ç½®é¢æ¿
    â””â”€â”€ DraggableComponentItem.tsx  # ç»„ä»¶é¢æ¿æ‹–æ‹½é¡¹
```

#### useComponents Hook

æ ¸å¿ƒçŠ¶æ€ç®¡ç† Hookï¼Œæä¾›ï¼š

```typescript
const {
  components, // ç»„ä»¶åˆ—è¡¨
  selectedId, // é€‰ä¸­ç»„ä»¶ ID
  hasChanges, // æ˜¯å¦æœ‰æœªä¿å­˜ä¿®æ”¹
  canUndo,
  canRedo, // æ’¤é”€/é‡åšçŠ¶æ€
  addComponent, // æ·»åŠ ç»„ä»¶
  deleteComponent, // åˆ é™¤ç»„ä»¶
  updateComponent, // æ›´æ–°ç»„ä»¶å±æ€§
  moveComponent, // ç§»åŠ¨ç»„ä»¶ä½ç½®
  undo,
  redo, // æ’¤é”€/é‡åšæ“ä½œ
} = useComponents();
```

#### ç»„ä»¶æ•°æ®ç»“æ„

```typescript
interface PageComponent {
  id: string;
  type: PageComponentType;
  title?: string;
  visible: boolean;
  props: Record<string, unknown>;
  // è‡ªç”±å¸ƒå±€å±æ€§
  x?: number; // X åæ ‡
  y?: number; // Y åæ ‡
  width?: number; // å®½åº¦
  height?: number; // é«˜åº¦
  zIndex?: number; // å±‚çº§
  locked?: boolean; // æ˜¯å¦é”å®š
}
```

## äº”ã€çŠ¶æ€ç®¡ç†è®¾è®¡

### 5.1 å…¨å±€çŠ¶æ€ (Zustand)

```typescript
// è®¤è¯çŠ¶æ€
const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      token: null,
      isAuthenticated: false,
      setAuth: (user, token) => set({ user, token, isAuthenticated: true }),
      logout: () => set({ user: null, token: null, isAuthenticated: false }),
    }),
    { name: "auth-storage" }
  )
);
```

### 5.2 æœåŠ¡ç«¯çŠ¶æ€ (React Query)

```typescript
// è®¢å•åˆ—è¡¨
const { data, isLoading, refetch } = useQuery({
  queryKey: ["orders", page, status],
  queryFn: () => api.getOrders({ page, status }),
});

// åˆ›å»ºå•†å“
const createMutation = useMutation({
  mutationFn: (data) => api.createProduct(data),
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ["products"] });
  },
});
```

## å…­ã€æ ·å¼ç³»ç»Ÿ

### 6.1 CSS å˜é‡

```css
:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --primary: 221.2 83.2% 53.3%;
  --primary-foreground: 210 40% 98%;
  --destructive: 0 84.2% 60.2%;
  --border: 214.3 31.8% 91.4%;
  --radius: 0.5rem;
}
```

### 6.2 ç»„ä»¶å˜ä½“ (CVA)

```typescript
const buttonVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground",
        destructive: "bg-destructive text-destructive-foreground",
        outline: "border border-input bg-background",
        ghost: "hover:bg-accent",
      },
      size: {
        default: "h-9 px-4 py-2",
        sm: "h-8 px-3",
        lg: "h-10 px-8",
        icon: "h-9 w-9",
      },
    },
  }
);
```

## ä¸ƒã€æƒé™æ§åˆ¶ (é¢„ç•™)

### 7.1 RBAC æ¨¡å‹

| è§’è‰²        | æƒé™                     |
| :---------- | :----------------------- |
| SUPER_ADMIN | å…¨éƒ¨æƒé™ï¼Œå¯ç®¡ç†æ‰€æœ‰é—¨åº— |
| OWNER       | ç®¡ç†æœ¬é—¨åº—æ•°æ®           |
| STAFF       | æŸ¥çœ‹è®¢å•ã€å¤„ç†è®¢å•       |

### 7.2 è·¯ç”±å®ˆå«

```typescript
// middleware.ts (å¾…å®ç°)
export function middleware(request: NextRequest) {
  const token = request.cookies.get("token");
  if (!token && request.nextUrl.pathname.startsWith("/dashboard")) {
    return NextResponse.redirect(new URL("/login", request.url));
  }
}
```

## å…«ã€æ€§èƒ½ä¼˜åŒ–

- **Server Components**: é»˜è®¤æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå‡å°‘å®¢æˆ·ç«¯ JS
- **åŠ¨æ€å¯¼å…¥**: å¤§å‹ç»„ä»¶æŒ‰éœ€åŠ è½½
- **å›¾ç‰‡ä¼˜åŒ–**: ä½¿ç”¨ Next.js Image ç»„ä»¶
- **ç¼“å­˜ç­–ç•¥**: React Query æ™ºèƒ½ç¼“å­˜

## ä¹ã€åç»­è®¡åˆ’

- [ ] å®Œå–„æƒé™æ§åˆ¶ä¸­é—´ä»¶
- [ ] æ·»åŠ æ“ä½œæ—¥å¿—è®°å½•
- [ ] å®ç°å®æ—¶è®¢å•é€šçŸ¥ (WebSocket)
- [ ] ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ
- [ ] æ·»åŠ ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
