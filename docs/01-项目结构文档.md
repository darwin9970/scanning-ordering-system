# æ¡Œå°æ‰«ç ç‚¹å•ç³»ç»Ÿ - é¡¹ç›®ç»“æ„æ–‡æ¡£

> æ›´æ–°æ—¶é—´: 2025-12-03

## ä¸€ã€é¡¹ç›®æ¦‚è§ˆ

æœ¬é¡¹ç›®åŒ…å«ä¸‰ä¸ªä¸»è¦å­é¡¹ç›®ï¼š

| é¡¹ç›® | æŠ€æœ¯æ ˆ | ç›®å½• | ç«¯å£ |
|:---|:---|:---|:---|
| **åå°ç®¡ç†ç³»ç»Ÿ** | Next.js 16 + TailwindCSS | `/admin` | 3000 |
| **API æœåŠ¡** | Elysia + Drizzle + Redis | `/api` | 4000 |
| **å°ç¨‹åºç«¯** | uni-app (Vue3) | `/mini` | - |

## äºŒã€ç›®å½•ç»“æ„

### 2.1 API æœåŠ¡ (`/api`)

```
api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # å…¥å£æ–‡ä»¶ï¼ŒElysia åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ schema.ts         # Drizzle æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts          # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ auth.ts           # ğŸ†• RBAC æƒé™ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ redis.ts          # Redis å®¢æˆ·ç«¯é…ç½®
â”‚   â”‚   â””â”€â”€ utils.ts          # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.ts           # è®¤è¯è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ stores.ts         # é—¨åº—ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ tables.ts         # æ¡Œå°ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ categories.ts     # åˆ†ç±»ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ products.ts       # å•†å“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ orders.ts         # è®¢å•ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ printers.ts       # æ‰“å°æœºç®¡ç†
â”‚   â”‚   â”œâ”€â”€ dashboard.ts      # æ•°æ®çœ‹æ¿
â”‚   â”‚   â”œâ”€â”€ staff.ts          # å‘˜å·¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ settings.ts       # ç³»ç»Ÿè®¾ç½®
â”‚   â”‚   â”œâ”€â”€ roles.ts          # ğŸ†• è§’è‰²æƒé™é…ç½®
â”‚   â”‚   â”œâ”€â”€ coupons.ts        # ğŸ†• ä¼˜æƒ åˆ¸ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ promotions.ts     # ğŸ†• è¥é”€æ´»åŠ¨
â”‚   â”‚   â”œâ”€â”€ members.ts        # ğŸ†• ä¼šå‘˜ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ combos.ts         # ğŸ†• å¥—é¤ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ service.ts        # ğŸ†• æœåŠ¡å‘¼å«
â”‚   â”‚   â”œâ”€â”€ cart.ts           # ğŸ†• è´­ç‰©è½¦
â”‚   â”‚   â””â”€â”€ upload.ts         # ğŸ†• æ–‡ä»¶ä¸Šä¼ 
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ stock-service.ts  # ğŸ†• åº“å­˜æœåŠ¡
â”‚   â”œâ”€â”€ ws/                   # WebSocket æ¨¡å—
â”‚   â””â”€â”€ worker/               # æ‰“å° Worker
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ seed.ts               # æ•°æ®åº“ç§å­è„šæœ¬
â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 2.2 åå°ç®¡ç†ç³»ç»Ÿ (`/admin`)

```
admin/
â”œâ”€â”€ app/                          # App Router é¡µé¢
â”‚   â”œâ”€â”€ layout.tsx                # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx                  # é¦–é¡µï¼ˆé‡å®šå‘åˆ° dashboardï¼‰
â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ page.tsx              # ç™»å½•é¡µ
â”‚   â””â”€â”€ dashboard/
â”‚       â”œâ”€â”€ layout.tsx            # åå°å¸ƒå±€
â”‚       â”œâ”€â”€ page.tsx              # æ•°æ®æ¦‚è§ˆ
â”‚       â”œâ”€â”€ orders/               # è®¢å•ç®¡ç†
â”‚       â”œâ”€â”€ products/             # å•†å“ç®¡ç†
â”‚       â”œâ”€â”€ categories/           # åˆ†ç±»ç®¡ç†
â”‚       â”œâ”€â”€ tables/               # æ¡Œå°ç®¡ç†
â”‚       â”œâ”€â”€ printers/             # æ‰“å°æœºé…ç½®
â”‚       â”œâ”€â”€ stores/               # é—¨åº—ç®¡ç†
â”‚       â”œâ”€â”€ reports/              # æ•°æ®æŠ¥è¡¨
â”‚       â”œâ”€â”€ staff/                # å‘˜å·¥ç®¡ç†
â”‚       â”œâ”€â”€ settings/             # ç³»ç»Ÿè®¾ç½®
â”‚       â”œâ”€â”€ roles/                # ğŸ†• è§’è‰²æƒé™é…ç½®
â”‚       â”œâ”€â”€ coupons/              # ğŸ†• ä¼˜æƒ åˆ¸ç®¡ç†
â”‚       â”œâ”€â”€ promotions/           # ğŸ†• è¥é”€æ´»åŠ¨
â”‚       â”œâ”€â”€ members/              # ğŸ†• ä¼šå‘˜ç®¡ç†
â”‚       â”œâ”€â”€ combos/               # ğŸ†• å¥—é¤ç®¡ç†
â”‚       â””â”€â”€ service/              # ğŸ†• æœåŠ¡å‘¼å«
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                       # åŸºç¡€ UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ badge.tsx
â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”œâ”€â”€ table.tsx
â”‚   â”‚   â”œâ”€â”€ label.tsx
â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”œâ”€â”€ textarea.tsx
â”‚   â”‚   â”œâ”€â”€ switch.tsx
â”‚   â”‚   â”œâ”€â”€ tabs.tsx              # ğŸ†• æ ‡ç­¾é¡µ
â”‚   â”‚   â”œâ”€â”€ checkbox.tsx          # ğŸ†• å¤é€‰æ¡†
â”‚   â”‚   â”œâ”€â”€ alert.tsx             # ğŸ†• è­¦å‘Šæ¡†
â”‚   â”‚   â”œâ”€â”€ scroll-area.tsx       # ğŸ†• æ»šåŠ¨åŒºåŸŸ
â”‚   â”‚   â””â”€â”€ image-upload.tsx      # ğŸ†• å›¾ç‰‡ä¸Šä¼ 
â”‚   â”œâ”€â”€ layout/                   # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ sidebar.tsx           # ä¾§è¾¹æ ï¼ˆæ”¯æŒæŠ˜å ï¼‰
â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â””â”€â”€ dashboard-layout.tsx
â”‚   â”œâ”€â”€ permission-guard.tsx      # ğŸ†• æƒé™å®ˆå«ç»„ä»¶
â”‚   â””â”€â”€ providers.tsx             # React Query Provider
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api.ts                    # API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ utils.ts                  # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ permissions.ts            # ğŸ†• æƒé™æ£€æŸ¥å‡½æ•°
â”‚   â”œâ”€â”€ validations.ts            # è¡¨å•æ ¡éªŒ (zod)
â”‚   â””â”€â”€ websocket.ts              # WebSocket Hook
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ use-permission.ts         # ğŸ†• æƒé™æ£€æŸ¥ Hook
â”œâ”€â”€ store/
â”‚   â””â”€â”€ auth.ts                   # Zustand è®¤è¯çŠ¶æ€
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                  # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 2.3 å°ç¨‹åºç«¯ (`/mini`)

```
mini/
â”œâ”€â”€ pages/                        # é¡µé¢
â”‚   â”œâ”€â”€ index/                    # é¦–é¡µï¼ˆæ‰«ç å…¥å£ï¼‰
â”‚   â”œâ”€â”€ scan/                     # æ‰«ç ç»“æœé¡µ
â”‚   â”œâ”€â”€ menu/                     # èœå•é¡µï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ order/                    # è®¢å•ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ confirm.vue           # ç¡®è®¤ä¸‹å•
â”‚   â”‚   â”œâ”€â”€ detail.vue            # è®¢å•è¯¦æƒ…
â”‚   â”‚   â””â”€â”€ list.vue              # è®¢å•åˆ—è¡¨
â”‚   â””â”€â”€ mine/                     # æˆ‘çš„
â”‚       â””â”€â”€ mine.vue              # ä¸ªäººä¸­å¿ƒ
â”œâ”€â”€ components/                   # ç»„ä»¶
â”‚   â””â”€â”€ q-*/                      # è‡ªå®šä¹‰ç»„ä»¶
â”œâ”€â”€ store/                        # Pinia çŠ¶æ€
â”‚   â”œâ”€â”€ table.js                  # æ¡Œå°/é—¨åº—ä¿¡æ¯
â”‚   â”œâ”€â”€ cart.js                   # è´­ç‰©è½¦
â”‚   â””â”€â”€ order.js                  # è®¢å•
â”œâ”€â”€ api/                          # API å°è£…
â”‚   â””â”€â”€ index.js                  # æ¥å£å®šä¹‰
â”œâ”€â”€ static/                       # é™æ€èµ„æº
â”œâ”€â”€ styles/                       # æ ·å¼
â”‚   â”œâ”€â”€ variables.scss            # å˜é‡å®šä¹‰
â”‚   â””â”€â”€ mixins.scss               # æ··å…¥
â”œâ”€â”€ uni_modules/                  # uni-app æ¨¡å—
â”œâ”€â”€ App.vue                       # åº”ç”¨å…¥å£
â”œâ”€â”€ main.js                       # ä¸»å…¥å£
â”œâ”€â”€ manifest.json                 # åº”ç”¨é…ç½®
â”œâ”€â”€ pages.json                    # é¡µé¢é…ç½®
â””â”€â”€ uni.scss                      # å…¨å±€æ ·å¼
```

## ä¸‰ã€æŠ€æœ¯æ ˆè¯¦æƒ…

### 3.1 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|:---|:---|:---|
| Elysia | 1.4.x | é«˜æ€§èƒ½ API æ¡†æ¶ |
| Drizzle | 0.44.x | ORMï¼Œç±»å‹å®‰å…¨ |
| ioredis | 5.x | Redis å®¢æˆ·ç«¯ |
| @elysiajs/jwt | 1.4.x | JWT è®¤è¯ |
| @elysiajs/swagger | 1.3.x | API æ–‡æ¡£ |
| @elysiajs/cors | 1.4.x | è·¨åŸŸæ”¯æŒ |

### 3.2 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|:---|:---|:---|
| Next.js | 16.x | React æ¡†æ¶ |
| TailwindCSS | 4.x | CSS æ¡†æ¶ |
| @tanstack/react-query | 5.x | æ•°æ®è¯·æ±‚ |
| Zustand | 5.x | çŠ¶æ€ç®¡ç† |
| Radix UI | å„ç»„ä»¶ | æ— éšœç¢ UI åŸè¯­ |
| Lucide React | 0.5x | å›¾æ ‡åº“ |
| Recharts | 3.x | å›¾è¡¨åº“ |

## å››ã€å¯åŠ¨æŒ‡å—

### 4.1 ç¯å¢ƒå‡†å¤‡

1. å®‰è£… Bun è¿è¡Œæ—¶
2. å‡†å¤‡ PostgreSQL 16+ æ•°æ®åº“
3. å‡†å¤‡ Redis 7.0+ æœåŠ¡

### 4.2 API æœåŠ¡å¯åŠ¨

```bash
cd api

# 1. å®‰è£…ä¾èµ–
bun install

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“å’Œ Redis è¿æ¥

# 3. åˆå§‹åŒ–æ•°æ®åº“
bun run db:push

# 4. æ’­ç§æµ‹è¯•æ•°æ®
bun run db:seed

# 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
bun run dev
```

### 4.3 åå°ç®¡ç†ç³»ç»Ÿå¯åŠ¨

```bash
cd admin

# 1. å®‰è£…ä¾èµ–
bun install

# 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
bun run dev
```

### 4.4 è®¿é—®åœ°å€

- **åå°ç®¡ç†ç³»ç»Ÿ**: http://localhost:3000
- **API æœåŠ¡**: http://localhost:4000
- **API æ–‡æ¡£**: http://localhost:4000/swagger

### 4.5 æµ‹è¯•è´¦å·

- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`

## äº”ã€å¼€å‘è§„èŒƒ

### 5.1 ä»£ç é£æ ¼

- ä½¿ç”¨ TypeScript å¼ºç±»å‹
- ç»„ä»¶ä½¿ç”¨å‡½æ•°å¼ç»„ä»¶ + Hooks
- API è·¯ç”±æŒ‰æ¨¡å—ç»„ç»‡
- ä½¿ç”¨ Drizzle ORM è¿›è¡Œæ•°æ®åº“æ“ä½œ

### 5.2 Git æäº¤è§„èŒƒ

```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤ bug
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼
refactor: é‡æ„
test: æµ‹è¯•
chore: æ„å»º/å·¥å…·
```

## å…­ã€åŠŸèƒ½å®ŒæˆçŠ¶æ€

### 6.1 åå°ç®¡ç†ç³»ç»Ÿ

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|:---|:---|:---|
| æ•°æ®æ¦‚è§ˆ | âœ… å®Œæˆ | è¥æ”¶ç»Ÿè®¡ã€è®¢å•è¶‹åŠ¿å›¾è¡¨ |
| è®¢å•ç®¡ç† | âœ… å®Œæˆ | è®¢å•åˆ—è¡¨ã€è¯¦æƒ…ã€çŠ¶æ€æµè½¬ã€é€€æ¬¾ |
| å•†å“ç®¡ç† | âœ… å®Œæˆ | SPU/SKUã€å¤šè§„æ ¼ã€å±æ€§ç®¡ç† |
| åˆ†ç±»ç®¡ç† | âœ… å®Œæˆ | æ‹–æ‹½æ’åºã€æ‰“å°æœºç»‘å®š |
| æ¡Œå°ç®¡ç† | âœ… å®Œæˆ | äºŒç»´ç ç”Ÿæˆã€æ‰¹é‡åˆ›å»º |
| æ‰“å°æœºé…ç½® | âœ… å®Œæˆ | æ‰“å°æœºç®¡ç†ã€æµ‹è¯•æ‰“å°ã€é¢„è§ˆ |
| é—¨åº—ç®¡ç† | âœ… å®Œæˆ | å¤šé—¨åº—æ”¯æŒ |
| å‘˜å·¥ç®¡ç† | âœ… å®Œæˆ | å‘˜å·¥ CRUDã€è§’è‰²åˆ†é… |
| è§’è‰²æƒé™ | âœ… å®Œæˆ | RBAC æƒé™ç³»ç»Ÿã€åŠ¨æ€é…ç½® |
| ä¼˜æƒ åˆ¸ | âœ… å®Œæˆ | æ»¡å‡åˆ¸ã€æŠ˜æ‰£åˆ¸ã€æ— é—¨æ§›åˆ¸ |
| è¥é”€æ´»åŠ¨ | âœ… å®Œæˆ | æ»¡å‡æ´»åŠ¨ã€é™æ—¶æŠ˜æ‰£ |
| ä¼šå‘˜ç®¡ç† | âœ… å®Œæˆ | ä¼šå‘˜ç­‰çº§ã€ç§¯åˆ†è§„åˆ™ |
| å¥—é¤ç®¡ç† | âœ… å®Œæˆ | å¥—é¤åˆ›å»ºã€å•†å“ç»„åˆ |
| æœåŠ¡å‘¼å« | âœ… å®Œæˆ | å‘¼å«è®°å½•ã€çŠ¶æ€å¤„ç† |
| æ•°æ®æŠ¥è¡¨ | âœ… å®Œæˆ | é”€å”®æŠ¥è¡¨ã€åˆ†ç±»ç»Ÿè®¡ã€å›¾è¡¨ |
| ç³»ç»Ÿè®¾ç½® | âœ… å®Œæˆ | å„ç±»é…ç½®é¡¹ |

### 6.2 API æœåŠ¡

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|:---|:---|:---|
| è®¤è¯æˆæƒ | âœ… å®Œæˆ | JWT + RBAC |
| åŸºç¡€ CRUD | âœ… å®Œæˆ | æ‰€æœ‰å®ä½“ |
| WebSocket | âœ… å®Œæˆ | å®æ—¶é€šä¿¡ |
| æ‰“å°æœåŠ¡ | âœ… å®Œæˆ | Redis Stream + Worker |
| æ–‡ä»¶ä¸Šä¼  | âœ… å®Œæˆ | å›¾ç‰‡ä¸Šä¼  |

### 6.3 å°ç¨‹åºç«¯

| åŠŸèƒ½æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|:---|:---|:---|
| é¡¹ç›®æ¡†æ¶ | âœ… å®Œæˆ | uni-app + Vue3 + Pinia |
| æ‰«ç å…¥å£ | âœ… å®Œæˆ | é¦–é¡µã€æ‰«ç é¡µ |
| èœå•é¡µé¢ | âœ… å®Œæˆ | åˆ†ç±»å¯¼èˆªã€å•†å“åˆ—è¡¨ã€è½®æ’­å›¾ã€å…¬å‘Š |
| è´­ç‰©è½¦ | âœ… å®Œæˆ | åŠ å‡å•†å“ã€æ¸…ç©º |
| è®¢å•ç¡®è®¤ | âœ… å®Œæˆ | ç‚¹é¤æç¤ºã€èµ·è®¢é‡‘é¢æ ¡éªŒ |
| è®¢å•åˆ—è¡¨ | âœ… å®Œæˆ | è®¢å•çŠ¶æ€ç­›é€‰ |
| è®¢å•è¯¦æƒ… | âœ… å®Œæˆ | çŠ¶æ€æ˜¾ç¤º |
| ä¸ªäººä¸­å¿ƒ | âœ… å®Œæˆ | WiFiä¿¡æ¯ã€åˆ‡æ¢æ¡Œå° |
| é—¨åº—é…ç½® | âœ… å®Œæˆ | å…¬å‘Šã€è¥ä¸šæ—¶é—´ã€WiFiç­‰ |
| ååŒç‚¹å• | ğŸ”² å¾…å¼€å‘ | WebSocket åŒæ­¥ |
| æ”¯ä»˜å¯¹æ¥ | ğŸ”² å¾…å¼€å‘ | å¾®ä¿¡æ”¯ä»˜ |

## ä¸ƒã€ä¸‹ä¸€æ­¥è®¡åˆ’

- [x] å®Œå–„æ‰“å° Worker æœåŠ¡
- [x] å®ç° WebSocket å®æ—¶é€šä¿¡
- [x] å®ç°å‘˜å·¥ç®¡ç†åŠŸèƒ½
- [x] å®ç°ç³»ç»Ÿè®¾ç½®åŠŸèƒ½
- [x] å®ç° RBAC æƒé™ç³»ç»Ÿ
- [x] å®ç°ä¼˜æƒ åˆ¸ã€è¥é”€æ´»åŠ¨æ¨¡å—
- [x] å®ç°ä¼šå‘˜ç§¯åˆ†æ¨¡å—
- [x] å¼€å‘å°ç¨‹åºç«¯æ ¸å¿ƒåŠŸèƒ½
- [x] å®ç°é—¨åº—é…ç½®åŠŸèƒ½ï¼ˆè½®æ’­å›¾ã€å…¬å‘Šã€WiFiç­‰ï¼‰
- [ ] å®ç°ååŒç‚¹å•ï¼ˆWebSocket è´­ç‰©è½¦åŒæ­¥ï¼‰
- [ ] å¯¹æ¥å¾®ä¿¡æ”¯ä»˜
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

## å…«ã€ç›¸å…³æ–‡æ¡£

- [02-æ•°æ®åº“è®¾è®¡æ–‡æ¡£](./02-æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md)
- [03-APIæ¥å£æ–‡æ¡£](./03-APIæ¥å£æ–‡æ¡£.md)
- [04-åå°ç®¡ç†ç³»ç»Ÿæ¶æ„æ–‡æ¡£](./04-åå°ç®¡ç†ç³»ç»Ÿæ¶æ„æ–‡æ¡£.md)
- [05-å¼€å‘ä¸éƒ¨ç½²æŒ‡å—](./05-å¼€å‘ä¸éƒ¨ç½²æŒ‡å—.md)
- [06-å°ç¨‹åºåŠŸèƒ½è§„åˆ’æ–‡æ¡£](./06-å°ç¨‹åºåŠŸèƒ½è§„åˆ’æ–‡æ¡£.md)
