# 桌台扫码点单系统 - 项目结构文档

> 更新时间: 2025-12-03

## 一、项目概览

本项目包含三个主要子项目：

| 项目 | 技术栈 | 目录 | 端口 |
|:---|:---|:---|:---|
| **后台管理系统** | Next.js 16 + TailwindCSS | `/admin` | 3000 |
| **API 服务** | Elysia + Drizzle + Redis | `/api` | 4000 |
| **小程序端** | uni-app (Vue3) | `/mini` | - |

## 二、目录结构

### 2.1 API 服务 (`/api`)

```
api/
├── src/
│   ├── index.ts              # 入口文件，Elysia 应用配置
│   ├── db/
│   │   ├── schema.ts         # Drizzle 数据模型定义
│   │   └── index.ts          # 数据库连接
│   ├── lib/
│   │   ├── auth.ts           # 🆕 RBAC 权限系统
│   │   ├── redis.ts          # Redis 客户端配置
│   │   └── utils.ts          # 工具函数
│   ├── routes/
│   │   ├── auth.ts           # 认证路由
│   │   ├── stores.ts         # 门店管理
│   │   ├── tables.ts         # 桌台管理
│   │   ├── categories.ts     # 分类管理
│   │   ├── products.ts       # 商品管理
│   │   ├── orders.ts         # 订单管理
│   │   ├── printers.ts       # 打印机管理
│   │   ├── dashboard.ts      # 数据看板
│   │   ├── staff.ts          # 员工管理
│   │   ├── settings.ts       # 系统设置
│   │   ├── roles.ts          # 🆕 角色权限配置
│   │   ├── coupons.ts        # 🆕 优惠券管理
│   │   ├── promotions.ts     # 🆕 营销活动
│   │   ├── members.ts        # 🆕 会员管理
│   │   ├── combos.ts         # 🆕 套餐管理
│   │   ├── service.ts        # 🆕 服务呼叫
│   │   ├── cart.ts           # 🆕 购物车
│   │   └── upload.ts         # 🆕 文件上传
│   ├── services/
│   │   └── stock-service.ts  # 🆕 库存服务
│   ├── ws/                   # WebSocket 模块
│   └── worker/               # 打印 Worker
├── scripts/
│   └── seed.ts               # 数据库种子脚本
├── .env.example              # 环境变量示例
├── package.json
└── tsconfig.json
```

### 2.2 后台管理系统 (`/admin`)

```
admin/
├── app/                          # App Router 页面
│   ├── layout.tsx                # 根布局
│   ├── page.tsx                  # 首页（重定向到 dashboard）
│   ├── login/
│   │   └── page.tsx              # 登录页
│   └── dashboard/
│       ├── layout.tsx            # 后台布局
│       ├── page.tsx              # 数据概览
│       ├── orders/               # 订单管理
│       ├── products/             # 商品管理
│       ├── categories/           # 分类管理
│       ├── tables/               # 桌台管理
│       ├── printers/             # 打印机配置
│       ├── stores/               # 门店管理
│       ├── reports/              # 数据报表
│       ├── staff/                # 员工管理
│       ├── settings/             # 系统设置
│       ├── roles/                # 🆕 角色权限配置
│       ├── coupons/              # 🆕 优惠券管理
│       ├── promotions/           # 🆕 营销活动
│       ├── members/              # 🆕 会员管理
│       ├── combos/               # 🆕 套餐管理
│       └── service/              # 🆕 服务呼叫
├── components/
│   ├── ui/                       # 基础 UI 组件
│   │   ├── button.tsx
│   │   ├── input.tsx
│   │   ├── card.tsx
│   │   ├── badge.tsx
│   │   ├── dialog.tsx
│   │   ├── table.tsx
│   │   ├── label.tsx
│   │   ├── select.tsx
│   │   ├── textarea.tsx
│   │   ├── switch.tsx
│   │   ├── tabs.tsx              # 🆕 标签页
│   │   ├── checkbox.tsx          # 🆕 复选框
│   │   ├── alert.tsx             # 🆕 警告框
│   │   ├── scroll-area.tsx       # 🆕 滚动区域
│   │   └── image-upload.tsx      # 🆕 图片上传
│   ├── layout/                   # 布局组件
│   │   ├── sidebar.tsx           # 侧边栏（支持折叠）
│   │   ├── header.tsx
│   │   └── dashboard-layout.tsx
│   ├── permission-guard.tsx      # 🆕 权限守卫组件
│   └── providers.tsx             # React Query Provider
├── lib/
│   ├── api.ts                    # API 客户端
│   ├── utils.ts                  # 工具函数
│   ├── permissions.ts            # 🆕 权限检查函数
│   ├── validations.ts            # 表单校验 (zod)
│   └── websocket.ts              # WebSocket Hook
├── hooks/
│   └── use-permission.ts         # 🆕 权限检查 Hook
├── store/
│   └── auth.ts                   # Zustand 认证状态
├── types/
│   └── index.ts                  # TypeScript 类型定义
├── package.json
└── tsconfig.json
```

### 2.3 小程序端 (`/mini`)

```
mini/
├── pages/                        # 页面
│   ├── index/                    # 首页（扫码入口）
│   ├── scan/                     # 扫码结果页
│   ├── menu/                     # 菜单页（核心）
│   ├── order/                    # 订单相关
│   │   ├── confirm.vue           # 确认下单
│   │   ├── detail.vue            # 订单详情
│   │   └── list.vue              # 订单列表
│   └── mine/                     # 我的
│       └── mine.vue              # 个人中心
├── components/                   # 组件
│   └── q-*/                      # 自定义组件
├── store/                        # Pinia 状态
│   ├── table.js                  # 桌台/门店信息
│   ├── cart.js                   # 购物车
│   └── order.js                  # 订单
├── api/                          # API 封装
│   └── index.js                  # 接口定义
├── static/                       # 静态资源
├── styles/                       # 样式
│   ├── variables.scss            # 变量定义
│   └── mixins.scss               # 混入
├── uni_modules/                  # uni-app 模块
├── App.vue                       # 应用入口
├── main.js                       # 主入口
├── manifest.json                 # 应用配置
├── pages.json                    # 页面配置
└── uni.scss                      # 全局样式
```

## 三、技术栈详情

### 3.1 后端技术栈

| 技术 | 版本 | 用途 |
|:---|:---|:---|
| Elysia | 1.4.x | 高性能 API 框架 |
| Drizzle | 0.44.x | ORM，类型安全 |
| ioredis | 5.x | Redis 客户端 |
| @elysiajs/jwt | 1.4.x | JWT 认证 |
| @elysiajs/swagger | 1.3.x | API 文档 |
| @elysiajs/cors | 1.4.x | 跨域支持 |

### 3.2 前端技术栈

| 技术 | 版本 | 用途 |
|:---|:---|:---|
| Next.js | 16.x | React 框架 |
| TailwindCSS | 4.x | CSS 框架 |
| @tanstack/react-query | 5.x | 数据请求 |
| Zustand | 5.x | 状态管理 |
| Radix UI | 各组件 | 无障碍 UI 原语 |
| Lucide React | 0.5x | 图标库 |
| Recharts | 3.x | 图表库 |

## 四、启动指南

### 4.1 环境准备

1. 安装 Bun 运行时
2. 准备 PostgreSQL 16+ 数据库
3. 准备 Redis 7.0+ 服务

### 4.2 API 服务启动

```bash
cd api

# 1. 安装依赖
bun install

# 2. 配置环境变量
cp .env.example .env
# 编辑 .env 文件，配置数据库和 Redis 连接

# 3. 初始化数据库
bun run db:push

# 4. 播种测试数据
bun run db:seed

# 5. 启动开发服务器
bun run dev
```

### 4.3 后台管理系统启动

```bash
cd admin

# 1. 安装依赖
bun install

# 2. 启动开发服务器
bun run dev
```

### 4.4 访问地址

- **后台管理系统**: http://localhost:3000
- **API 服务**: http://localhost:4000
- **API 文档**: http://localhost:4000/swagger

### 4.5 测试账号

- 用户名: `admin`
- 密码: `admin123`

## 五、开发规范

### 5.1 代码风格

- 使用 TypeScript 强类型
- 组件使用函数式组件 + Hooks
- API 路由按模块组织
- 使用 Drizzle ORM 进行数据库操作

### 5.2 Git 提交规范

```
feat: 新功能
fix: 修复 bug
docs: 文档更新
style: 代码格式
refactor: 重构
test: 测试
chore: 构建/工具
```

## 六、功能完成状态

### 6.1 后台管理系统

| 功能模块 | 状态 | 说明 |
|:---|:---|:---|
| 数据概览 | ✅ 完成 | 营收统计、订单趋势图表 |
| 订单管理 | ✅ 完成 | 订单列表、详情、状态流转、退款 |
| 商品管理 | ✅ 完成 | SPU/SKU、多规格、属性管理 |
| 分类管理 | ✅ 完成 | 拖拽排序、打印机绑定 |
| 桌台管理 | ✅ 完成 | 二维码生成、批量创建 |
| 打印机配置 | ✅ 完成 | 打印机管理、测试打印、预览 |
| 门店管理 | ✅ 完成 | 多门店支持 |
| 员工管理 | ✅ 完成 | 员工 CRUD、角色分配 |
| 角色权限 | ✅ 完成 | RBAC 权限系统、动态配置 |
| 优惠券 | ✅ 完成 | 满减券、折扣券、无门槛券 |
| 营销活动 | ✅ 完成 | 满减活动、限时折扣 |
| 会员管理 | ✅ 完成 | 会员等级、积分规则 |
| 套餐管理 | ✅ 完成 | 套餐创建、商品组合 |
| 服务呼叫 | ✅ 完成 | 呼叫记录、状态处理 |
| 数据报表 | ✅ 完成 | 销售报表、分类统计、图表 |
| 系统设置 | ✅ 完成 | 各类配置项 |

### 6.2 API 服务

| 功能模块 | 状态 | 说明 |
|:---|:---|:---|
| 认证授权 | ✅ 完成 | JWT + RBAC |
| 基础 CRUD | ✅ 完成 | 所有实体 |
| WebSocket | ✅ 完成 | 实时通信 |
| 打印服务 | ✅ 完成 | Redis Stream + Worker |
| 文件上传 | ✅ 完成 | 图片上传 |

### 6.3 小程序端

| 功能模块 | 状态 | 说明 |
|:---|:---|:---|
| 项目框架 | ✅ 完成 | uni-app + Vue3 + Pinia |
| 扫码入口 | ✅ 完成 | 首页、扫码页 |
| 菜单页面 | ✅ 完成 | 分类导航、商品列表、轮播图、公告 |
| 购物车 | ✅ 完成 | 加减商品、清空、滑动删除 |
| 订单确认 | ✅ 完成 | 点餐提示、起订金额校验、积分抵扣 |
| 订单列表 | ✅ 完成 | 订单状态筛选、空状态优化 |
| 订单详情 | ✅ 完成 | 状态显示、状态轮询通知 |
| 个人中心 | ✅ 完成 | WiFi信息、切换桌台、会员卡片 |
| 会员系统 | ✅ 完成 | 微信登录、会员等级、积分记录 |
| 积分系统 | ✅ 完成 | 积分获取、积分抵扣、积分记录 |
| 搜索功能 | ✅ 完成 | 商品搜索、关键词高亮、搜索历史 |
| 门店配置 | ✅ 完成 | 公告、营业时间、WiFi等 |
| UI/UX 优化 | ✅ 完成 | 骨架屏、空状态、动画、错误处理 |
| 协同点单 | 🔲 待开发 | WebSocket 同步 |
| 支付对接 | 🔲 待开发 | 微信支付 |

## 七、下一步计划

- [x] 完善打印 Worker 服务
- [x] 实现 WebSocket 实时通信
- [x] 实现员工管理功能
- [x] 实现系统设置功能
- [x] 实现 RBAC 权限系统
- [x] 实现优惠券、营销活动模块
- [x] 实现会员积分模块
- [x] 开发小程序端核心功能
- [x] 实现门店配置功能（轮播图、公告、WiFi等）
- [x] 实现微信登录和会员系统
- [x] 实现积分系统和积分抵扣功能
- [x] 实现商品搜索功能
- [x] 完成 UI/UX 优化（骨架屏、空状态、动画、错误处理）
- [ ] 实现协同点单（WebSocket 购物车同步）
- [ ] 对接微信支付
- [ ] 部署到生产环境

## 八、相关文档

- [02-数据库设计文档](./02-数据库设计文档.md)
- [03-API接口文档](./03-API接口文档.md)
- [04-后台管理系统架构文档](./04-后台管理系统架构文档.md)
- [05-开发与部署指南](./05-开发与部署指南.md)
- [06-小程序功能规划文档](./06-小程序功能规划文档.md)
