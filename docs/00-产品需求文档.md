# 桌台扫码点单系统产品需求文档 (PRD)

## 1. 引言

### 1.1 背景与目的
随着餐饮行业数字化转型的深入，传统点单模式（人工点单、纸质菜单）存在效率低、易出错、数据难沉淀等问题。本系统旨在构建一套**高效、智能、稳定**的桌台扫码点单系统，通过“顾客自助点单 + 后厨自动分单 + 商家数字化管理”的闭环，提升门店运营效率与顾客用餐体验。

### 1.2 产品定位
一款支持**多人协同点单**、**后厨自动化分单**、**精细化库存管理**的餐饮 SaaS 小程序解决方案。

### 1.3 核心用户角色
| 角色 | 描述 | 核心诉求 |
| :--- | :--- | :--- |
| **顾客** | 到店用餐的消费者 | 扫码即点、多人一起点、操作流畅、实时看进度 |
| **店长/商家** | 门店管理者 | 订单不漏单、库存准、报表清晰、管理方便 |
| **厨师/吧台** | 后厨制作人员 | 自动出票、分单准确（热菜/冷菜/酒水分开） |

---

## 2. 功能需求 - 顾客端 (小程序)

### 2.0 首页与登录 **[新增]**
- **首页展示**：
    - **顶部 Banner**：展示门店活动、新品推荐。
    - **扫码入口**：醒目的“扫码点单”按钮，点击调用摄像头。
    - **最近订单**：展示最近一笔订单状态（如“制作中”），点击跳转详情。
    - **会员卡片**：展示当前积分、会员等级。
- **微信登录**：
    - **一键登录**：首次进入小程序时，自动弹出微信授权（或静默登录），获取 OpenID。
    - **用户信息**：支持获取用户头像、昵称（需用户授权）。

### 2.1 扫码开台与鉴权
- **扫码进入**：用户扫描桌台二维码，系统校验二维码有效性及距离（GPS 围栏）。
- **距离校验**：若用户距离门店超过 1km（可配置），提示“距离过远，无法点单”，防止恶意下单。
- **多人同桌**：支持多用户扫描同一二维码进入同一桌台，共享购物车状态。

### 2.2 菜单浏览与商品选择
- **分类导航**：左侧展示分类（热菜、凉菜、酒水等），点击锚点定位。
- **商品展示**：支持列表模式，展示商品图、名称、价格、销量。
- **多规格选择 (SKU)**：点击“选规格”弹出面板，支持选择规格（如：大/中/小）和属性（如：微辣/中辣、去冰/少冰）。
- **库存状态**：售罄商品置灰并不可选，低库存（<10）显示“仅剩X份”。

### 2.3 协同购物车
- **实时同步**：A 用户添加菜品，B 用户屏幕上实时显示，无需手动刷新。
- **操作冲突处理**：支持多人同时增减数量，基于原子操作保证数据一致性。
- **购物车管理**：查看已选列表，支持一键清空（需二次确认）。

### 2.4 下单与支付
- **下单确认**：展示订单明细、总金额、优惠明细。
- **支付方式**：支持微信支付。
- **支付兜底**：若支付后未回调，支持用户手动点击“我已支付”触发主动查询。

### 2.5 订单状态与进度
- **状态流转**：待支付 -> 制作中 -> 已完成。
- **进度展示**：实时显示当前订单状态，支持查看历史订单。

---

## 3. 功能需求 - 商家端 (Web 后台)

### 3.1 桌台与二维码管理
- **桌台管理**：增删改查桌台信息（名称、容纳人数）。
- **二维码生成**：一键生成桌台二维码，支持批量导出打印。

### 3.2 商品与菜单管理
- **分类管理**：创建、排序、隐藏菜品分类。
- **商品录入**：
    - 基础信息：名称、图片、描述、原价/现价。
    - **规格设置**：支持多规格（SKU）配置，独立设置价格与库存。
    - **属性设置**：支持加料、口味等非价格属性配置。
- **库存管理**：手动调整库存，支持“无限库存”模式。

### 3.3 打印机配置与分单
- **设备管理**：录入云打印机 SN 码与 Key。
- **分单规则**：
    - **后厨打印机**：绑定“热菜”、“凉菜”分类。
    - **吧台打印机**：绑定“酒水”、“饮料”分类。
    - **收银打印机**：打印全单小票。
- **测试打印**：支持发送测试页验证设备连通性。

### 3.4 订单管理
- **实时看板**：实时展示今日订单、待处理订单。
- **订单详情**：查看订单明细、支付状态、打印状态。
- **退款处理**：支持整单退款或部分商品退款。

### 3.5 数据报表
- **营收统计**：按日/周/月统计营业额、订单数、客单价。
- **商品排行**：销量 Top10、销售额 Top10 商品分析。

---

## 4. 非功能需求 (NFR)

### 4.1 性能要求
- **首屏加载**：小程序首屏加载时间 < 1.5s。
- **接口响应**：常规业务接口响应时间 < 500ms (P95)。
- **协同延迟**：多人购物车同步延迟 < 200ms。

### 4.2 可靠性要求
- **打印不丢单**：采用持久化队列机制，打印机断网/缺纸恢复后自动补打。
- **弱网可用性**：支持断网情况下查看已缓存的菜单数据。

### 4.3 安全性要求
- **防恶意下单**：结合 GPS 围栏与二维码签名机制。
- **数据一致性**：高并发下库存扣减准确，无超卖。

---

## 5. 附录
- **架构文档**：[00-系统架构设计文档](./00-系统架构设计文档.md)
